<html><head><title>Single Face and PuzzleGeometry</title>
<script src="PuzzleGeometry.js"></script>
<script>
function parseDesc(s) {
   var a = s.split(/ /).filter(Boolean) ;
   if (a.length % 2 == 0)
      return false ;
   if (a[0] != 'o' && a[0] != 'c' && a[0] != 'i' && a[0] != 'd' && a[0] != 't')
      return false ;
   var r = [] ;
   for (var i=1; i<a.length; i += 2) {
      if (a[i] != 'f' && a[i] != 'v' && a[i] != 'e')
         return false ;
      r.push([a[i], a[i+1]]) ;
   }
   return [a[0], r] ;
}
var lastval ;
var textinput ;
var distance ;
var pg ;
function checkchange() {
   var s = textinput.value ;
   if (s == lastval)
      return ;
   lastval = s ;
   var p = parseDesc(s) ;
   if (p) {
      pg = new PuzzleGeometry(p[0], p[1]) ;
      pg.allstickers() ;
      myfaces = pg.getfaces() ;
      distance = pg.vertexdistance * 3 ;
      var desc =
         "Faces " + pg.baseplanerot.length + "<BR>" +
         "Stickers per face " + pg.stickersperface + "<BR>" +
         "Cubies " + pg.cubies.length + "<BR>" +
         "Short edge " + pg.shortedge + "<BR>" +
         "Edge distance " + pg.edgedistance + "<BR>" +
         "Vertex distance " + pg.vertexdistance + "<BR>" ;
      document.getElementById('data').innerHTML = desc ;
      display() ;
   }
}
function doselection(el) {
   if (el.target.value != '') {
      textinput.value = el.target.value ;
      checkchange() ;
   }
}
var puz = null ;
function display() {
   if (!pg)
      return ;
   var boundarygeo = pg.getboundarygeometry() ;
   var face0 = boundarygeo.facenames[0][0] ;
   var polyn = face0.length ; // number of vertices; 3, 4, or 5
   var whmul = [1, 1] ; // width/height multipliers for a given poly
   if (polyn == 3) {
      whmul = [1, Math.sqrt(3)/2] ; // triangle is a bit shorter
   } else if (polyn == 4) {
      // no change; square works
   } else if (polyn == 5) {
      whmul = [(1+Math.sqrt(5))/2, 0.5*Math.sqrt(5+2*Math.sqrt(5))] ;
   } else {
      alert("Bad polyn " + polyn) ;
   }
   var canvas = document.getElementById("canvas");
   var context = canvas.getContext('2d');
   var trim = 10 ;
   context.save() ;
   context.clearRect(0, 0, canvas.width, canvas.height) ;
   var canwidth = canvas.width - 2 * trim ;
   var canheight = canvas.height - 2 * trim ;
   var sc = Math.min(canwidth/whmul[0], canheight/whmul[1]) ;
   context.translate(trim, canheight+trim) ;
   var geo = pg.project2d(0, 0,
                [Quat(0, canwidth/2-0.5*sc, -canheight/2+0.5*sc*whmul[1], 0),
                 Quat(0, canwidth/2+0.5*sc, -canheight/2+0.5*sc*whmul[1], 0)]) ;
   var faces = pg.faces ;
   var justone = faces.length / boundarygeo.facenames.length ;
   for (var j=0; j<justone; j++) {
      var face = faces[j] ;
      var pts = face.map(function(q) {
                    return [q.dot(geo[0])+geo[2].b, q.dot(geo[1])+geo[2].c]}) ;
      context.beginPath() ;
      context.moveTo(pts[0][0], pts[0][1]) ;
      for (var i=1; i<pts.length; i++)
         context.lineTo(pts[i][0], pts[i][1]) ;
      context.closePath() ;
      context.stroke() ;
   }
   context.restore() ;
}
function setup() {
   textinput = document.getElementById('desc') ;
   document.getElementById("puzzleoptions").onchange = doselection ;
   checkchange() ;
   setInterval(checkchange, 0.5) ;
}
</script>
</head>
<body onload="setup();">
Desc <input type=text id=desc value="c f 0.3333333333" size="50">
</input><br>
<select id="puzzleoptions">
<option value="">custom</option>
<option value="c f 0">2x2x2</option>
<option value="c f 0.333333333333333">3x3x3</option>
<option value="c f 0.5 f 0">4x4x4</option>
<option value="c f 0.6 f 0.2">5x5x5</option>
<option value="c f 0.666666666666667 f 0.333333333333333 f 0">6x6x6</option>
<option value="c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143">7x7x7</option>
<option value="c f 0.75 f 0.5 f 0.25 f 0">8x8x8</option>
<option value="c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111">9x9x9</option>
<option value="c f 0.8 f 0.6 f 0.4 f 0.2 f 0">10x10x10</option>
<option value="c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909">11x11x11</option>
<option value="c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0">12x12x12</option>
<option value="c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769">13x13x13</option>
<option value="c v 0">skewb</option>
<option value="c v 0.275">master skewb</option>
<option value="c v 0 v 0.38">professor skewb</option>
<option value="c e 0.707106781186547">helicopter</option>
<option value="c v 0.577350269189626">dino</option>
<option value="t v 0.333333333333333 v 1.66666666666667">pyraminx</option>
<option value="d f 0.7">megaminx</option>
<option value="d f 0.64 f 0.82">gigaminx</option>
<option value="d f 0">pentultimate</option>
<option value="d v 0.937962371425399">starminx</option>
<option value="d f 0.23606797749979">starminx 2</option>
<option value="d v 0">dodec star</option>
<option value="o f 0">skewb diamond</option>
<option value="o f 0.333333333333333">octahedron diamond</option>
<option value="i f 0">icosahedron skewb</option>
<option value="i v 0">icosahedron vskewb</option>
<option value="i v 0.18759247376021">icosahedron 2</option>
<option value="i v 0.18759247376021 e 0">icosahedron 3</option>
<option value="i v 0.84">icosahedron static faces</option>
<option value="i v 0.73">icosahedron moving faces</option>
</select>
<div id=data></div>
<canvas id="canvas" width=500 height=500>No canvas support?</canvas>
</body></html>
